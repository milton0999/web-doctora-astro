---
import Layout from '../../layouts/Layout.astro';
import ServicioCard from '../../components/ServicioCard.astro';
import { getCollection, getEntry } from 'astro:content';

// Mapeo de URLs a categorías
const categoryMapping = {
  'ecografias-adulto': 'Adulto',
  'ecografias-pediatrico': 'Pediatrico',
  'ecografias-materno': 'Embarazada',
  'ginecologia': 'Ginecologia'
};

// Nombres para mostrar
const nombresCategorias = {
  'Adulto': 'Ecografías para Adulto',
  'Embarazada': 'Ecografías Materno-Fetales',
  'Pediatrico': 'Ecografías Pediátricas',
  'Ginecologia': 'Estudios Ginecológicos'
};

// Metadatos por categoría
const metadatosCategoria = {
  'Adulto': {
    description: 'Estudios de ultrasonido especializados para adultos con tecnología de última generación',
    icon: 'bi-person-heart'
  },
  'Embarazada': {
    description: 'Ecografías materno-fetales para el seguimiento del embarazo y bienestar del bebé',
    icon: 'bi-heart-pulse'
  },
  'Pediatrico': {
    description: 'Estudios de ultrasonido diseñados específicamente para pacientes pediátricos',
    icon: 'bi-child'
  },
  'Ginecologia': {
    description: 'Estudios ginecológicos especializados para diagnóstico y prevención',
    icon: 'bi-heart'
  }
};

export async function getStaticPaths() {
  const servicios = await getCollection('servicios');
  const categoryKeys = Object.keys(categoryMapping);
  
  return categoryKeys.map(urlKey => {
    const categoria = categoryMapping[urlKey];
    const serviciosFiltrados = servicios.filter(s => s.data.categoria === categoria);
    
    return {
      params: { categoria: urlKey },
      props: { 
        categoria,
        serviciosFiltrados,
        urlKey,
        metadatos: metadatosCategoria[categoria]
      }
    };
  });
}

const { categoria, serviciosFiltrados, urlKey, metadatos } = Astro.props;

// Intentar obtener contenido personalizado de la categoría
let categoriaContent = null;
try {
  categoriaContent = await getEntry('categorias', categoria.toLowerCase());
} catch (e) {
  // Si no hay contenido personalizado, usar valores por defecto
}
---

<Layout 
  title={`${nombresCategorias[categoria]} - Centro Médico Gonzalitos`} 
  description={metadatos.description}
>
  <!-- Hero Section -->
  <section class="py-5 bg-primary position-relative overflow-hidden">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <div class="d-flex align-items-center mb-3">
            <i class="bi {metadatos.icon} text-white fs-1 me-3"></i>
            <div>
              <h1 class="display-4 fw-bold text-white mb-0">{nombresCategorias[categoria]}</h1>
              <p class="text-white-50 mb-0">Estudios especializados</p>
            </div>
          </div>
          <p class="lead text-white-50">
            {categoriaContent?.data.description || metadatos.description}
          </p>
        </div>
        <div class="col-lg-4">
          <div class="bg-white bg-opacity-10 rounded-3 p-4">
            <div class="text-center">
              <h3 class="text-white mb-0">{serviciosFiltrados.length}</h3>
              <p class="text-white-50">Estudios Disponibles</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contenido Personalizado si existe -->
  {categoriaContent && (
    <section class="py-4 bg-light">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="prose prose-lg">
              {categoriaContent.content}
            </div>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Lista de Servicios -->
  <section class="py-5">
    <div class="container">
      <div class="text-center mb-5">
        <h2 class="h2 fw-bold">Estudios Disponibles</h2>
        <p class="text-muted">Selecciona el estudio que necesitas para obtener más información</p>
      </div>

      {serviciosFiltrados.length > 0 ? (
        <div class="row g-4">
          {serviciosFiltrados.map(servicio => (
            <div class="col-md-6 col-lg-4">
              <ServicioCard servicio={servicio} />
            </div>
          ))}
        </div>
      ) : (
        <div class="text-center py-5">
          <i class="bi bi-inbox text-muted fs-1"></i>
          <h3 class="h4 text-muted mt-3">Próximamente</h3>
          <p class="text-muted">Estamos trabajando para bringerte los mejores estudios en esta categoría.</p>
        </div>
      )}
    </div>
  </section>

  <!-- Información Adicional -->
  <section class="py-5 bg-light">
    <div class="container">
      <div class="row g-4">
        <div class="col-md-4">
          <div class="text-center">
            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
              <i class="bi bi-shield-check text-primary fs-2"></i>
            </div>
            <h4>Calidad Garantizada</h4>
            <p class="text-muted">Equipamiento de última generación y personal certificado.</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="text-center">
            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
              <i class="bi bi-clock text-primary fs-2"></i>
            </div>
            <h4>Resultados Rápidos</h4>
            <p class="text-muted">Entrega de estudios en tiempo récord sin sacrificar la precisión.</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="text-center">
            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
              <i class="bi bi-heart text-primary fs-2"></i>
            </div>
            <h4>Atención Personalizada</h4>
            <p class="text-muted">Te acompañamos durante todo el proceso con profesionalismo y empatía.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="py-5">
    <div class="container">
      <div class="text-center">
        <h2 class="h2 fw-bold mb-3">¿Listo para agendar tu estudio?</h2>
        <p class="text-muted mb-4">Contáctanos para programar tu cita o resolver cualquier duda.</p>
        <div class="d-flex gap-3 justify-content-center flex-wrap">
          <a href="/contacto" class="btn btn-primary btn-lg">
            <i class="bi bi-envelope me-2"></i>Agendar Cita
          </a>
          <a href="tel:+528111234567" class="btn btn-outline-primary btn-lg">
            <i class="bi bi-telephone me-2"></i>Llamar Ahora
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Navegación entre categorías -->
  <section class="py-4 bg-white border-top">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-12">
          <p class="text-muted mb-2">Explorar otras categorías:</p>
          <div class="d-flex flex-wrap gap-2">
            {Object.entries(categoryMapping).map(([urlKey, cat]) => (
              cat !== categoria && (
                <a href={`/categoria-de-servicio/${urlKey}/`} class="btn btn-sm btn-outline-secondary">
                  {nombresCategorias[cat]}
                </a>
              )
            ))}
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .prose {
    max-width: none;
  }
  
  .prose h1, .prose h2, .prose h3 {
    color: var(--text-dark);
  }
  
  .prose p {
    color: var(--text-muted);
  }
</style>