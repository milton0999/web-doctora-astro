---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const promotions = await getCollection('promotions');
const activePromotions = promotions.filter(p => 
  p.data.active && new Date(p.data.valid_until) > new Date()
);
const expiredPromotions = promotions.filter(p => 
  !p.data.active || new Date(p.data.valid_until) <= new Date()
);
---

<Layout title="Promociones y Ofertas Especiales" description="Aprovecha nuestras promociones especiales en estudios m√©dicos">
    <div class="container py-5">
        <div class="text-center mb-5 fade-in-up">
            <h1 class="display-4 fw-bold" style="color: var(--primary-color);">Promociones Especiales</h1>
            <p class="lead">Aprovecha nuestros descuentos en estudios m√©dicos de alta calidad</p>
        </div>

        {activePromotions.length > 0 && (
            <section class="mb-5">
                <h2 class="mb-4">üî• Ofertas Activas</h2>
                <div class="row g-4">
                    {activePromotions.map(promotion => (
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 shadow-sm promotion-card border-0">
                                <img src={promotion.data.image} alt={promotion.data.title} class="card-img-top" style="height: 200px; object-fit: cover;" />
                                <div class="card-body">
                                    <h5 class="card-title">{promotion.data.title}</h5>
                                    <p class="card-text">{promotion.data.description}</p>
                                    <div class="price-comparison mb-3">
                                        <span class="text-muted text-decoration-line-through">${promotion.data.original_price}</span>
                                        <span class="h4 text-success ms-2">${promotion.data.sale_price}</span>
                                        <span class="badge bg-danger ms-2">-{promotion.data.discount_percentage}</span>
                                    </div>
                                    {promotion.data.services_included && promotion.data.services_included.length > 0 && (
                                        <div class="services-included mb-3">
                                            <strong>Incluye:</strong>
                                            <ul class="small">
                                                {promotion.data.services_included.map(service => (
                                                    <li>{service}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    )}
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">V√°lida hasta: {promotion.data.valid_until.toLocaleDateString('es-MX')}</small>
                                        <a href={`https://wa.me/528115883775?text=Hola, estoy interesado en la oferta: ${promotion.data.title}`} 
                                           class="btn btn-success btn-sm" target="_blank">
                                            Solicitar Oferta
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </section>
        )}

        {expiredPromotions.length > 0 && (
            <section>
                <h2 class="mb-4">‚è∞ Ofertas Expiradas</h2>
                <div class="row g-4">
                    {expiredPromotions.map(promotion => (
                        <div class="col-md-6 col-lg-4">
                            <div class="card h-100 shadow-sm promotion-card expired opacity-50">
                                <img src={promotion.data.image} alt={promotion.data.title} class="card-img-top" style="height: 200px; object-fit: cover;" />
                                <div class="card-body">
                                    <h5 class="card-title">{promotion.data.title}</h5>
                                    <p class="card-text">{promotion.data.description}</p>
                                    <div class="text-center">
                                        <span class="badge bg-secondary">Oferta Expirada</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
            </section>
        )}

        {promotions.length === 0 && (
            <div class="text-center py-5">
                <h3 class="text-muted">No hay promociones disponibles en este momento</h3>
                <p class="text-muted">Vuelve pronto para ver nuestras nuevas ofertas</p>
                <a href="https://wa.me/528115883775?text=Hola, deseo conocer las promociones disponibles" 
                   class="btn btn-primary" target="_blank">
                    üí¨ Consultar por WhatsApp
                </a>
            </div>
        )}
    </div>
</Layout>

<style>
.promotion-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 12px;
    overflow: hidden;
}

.promotion-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.15);
}

.promotion-card.expired {
    filter: grayscale(100%);
    opacity: 0.7;
}

.price-comparison {
    background-color: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
}

.services-included {
    font-size: 0.9rem;
}

.services-included ul {
    margin: 5px 0 0 20px;
    padding: 0;
}

.fade-in-up {
    animation: fadeInUp 0.6s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>